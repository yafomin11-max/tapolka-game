<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêï –ú–æ–ø—Å –¢–∞–ø–æ–ª–∫–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        .tap-area {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 15px;
            cursor: pointer;
            transition: transform 0.1s;
            user-select: none;
        }

        .tap-area:active {
            transform: scale(0.95);
        }

        .tap-text {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .tap-subtext {
            font-size: 14px;
            color: #666;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 15px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tab.active {
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .content-area {
            min-height: 300px;
        }

        .stars-package {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #333;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            text-align: center;
        }

        .package-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .package-stars {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .package-price {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .buy-stars-btn {
            background: #333;
            color: #FFD700;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            font-size: 16px;
        }

        .donate-item {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .currency-exchange {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .exchange-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            margin: 10px 0;
        }

        .exchange-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
        }

        .mining-display {
            text-align: center;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .notification.show {
            opacity: 1;
        }

        .stars-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
            text-align: center;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêï –ú–æ–ø—Å –¢–∞–ø–æ–ª–∫–∞</h1>
            <p>–¢–∞–ø–∞–π –º–æ–ø—Å–∞, —Å–æ–±–∏—Ä–∞–π –∫–∞—Ä—Ç–æ—á–∫–∏, –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –º–æ–Ω–µ—Ç—ã!</p>
        </div>

        <div class="card">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="coins">100</div>
                    <div class="stat-label">–ú–æ–Ω–µ—Ç—ã üêï</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="taps">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Ç–∞–ø–æ–≤</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="premium">0</div>
                    <div class="stat-label">–ü—Ä–µ–º–∏—É–º üíé</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="tokens">0</div>
                    <div class="stat-label">–¢–æ–∫–µ–Ω—ã ü™ô</div>
                </div>
            </div>

            <div class="mining-display">
                ‚õèÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–∞–π–Ω–∏–Ω–≥: <span id="miningRate">0</span> –º–æ–Ω–µ—Ç/—Å–µ–∫
            </div>

            <div class="tap-area" id="tapArea">
                <div class="tap-text">üéØ –¢–ê–ü–ù–ò –ú–û–ü–°–ê!</div>
                <div class="tap-subtext">–ó–∞—Ä–∞–±–æ—Ç–∞–π –º–æ–Ω–µ—Ç—ã</div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="shop">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω</div>
            <div class="tab" data-tab="stars">‚≠ê –ó–≤–µ–∑–¥—ã</div>
            <div class="tab" data-tab="inventory">üì¶ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
            <div class="tab" data-tab="exchange">üí± –û–±–º–µ–Ω</div>
        </div>

        <div class="content-area">
            <!-- –ú–∞–≥–∞–∑–∏–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ -->
            <div class="tab-content" id="shopContent">
                <div class="card">
                    <h3>üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω –∫–∞—Ä—Ç–æ—á–µ–∫</h3>
                    <div id="shopItems"></div>
                </div>
            </div>

            <!-- –î–æ–Ω–∞—Ç —á–µ—Ä–µ–∑ Stars -->
            <div class="tab-content" id="starsContent" style="display: none;">
                <div class="card">
                    <div class="stars-info">
                        ‚≠ê <strong>Telegram Stars</strong><br>
                        –ü–æ–∫—É–ø–∫–∞ –∑–≤–µ–∑–¥ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞!<br>
                        –ó–≤–µ–∑–¥—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞ –º–æ–π –∞–∫–∫–∞—É–Ω—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ ‚úÖ
                    </div>
                    
                    <h3>‚≠ê –ü–∞–∫–µ—Ç—ã –∑–≤–µ–∑–¥</h3>
                    <div id="starsPackages"></div>
                    
                    <h3 style="margin-top: 20px;">üõçÔ∏è –î–æ–Ω–∞—Ç –ø—Ä–µ–¥–º–µ—Ç—ã</h3>
                    <div id="donateItems"></div>
                </div>
            </div>

            <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
            <div class="tab-content" id="inventoryContent" style="display: none;">
                <div class="card">
                    <h3>üì¶ –í–∞—à–∏ –º–æ–ø—Å—ã</h3>
                    <div id="inventoryItems"></div>
                </div>
            </div>

            <!-- –û–±–º–µ–Ω –≤–∞–ª—é—Ç—ã -->
            <div class="tab-content" id="exchangeContent" style="display: none;">
                <div class="card">
                    <h3>üí± –û–±–º–µ–Ω –≤–∞–ª—é—Ç—ã</h3>
                    <div class="currency-exchange">
                        <p>–ö—É—Ä—Å: 1üíé = 0.1ü™ô</p>
                        <input type="number" class="exchange-input" id="exchangeAmount" placeholder="–°—É–º–º–∞" value="10">
                        <div style="display: flex; gap: 10px;">
                            <button class="exchange-btn" onclick="exchangeCurrency('premium')">
                                üíé ‚Üí ü™ô
                            </button>
                            <button class="exchange-btn" onclick="exchangeCurrency('tokens')">
                                ü™ô ‚Üí üíé
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // –ò–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        const CARD_TYPES = [
            { id: 1, name: "–ú–æ–ø—Å —à–∞—Ö—Ç–µ—Ä", emoji: "‚õèÔ∏èüêï", rarity: "common", price: 10, mining: 0.01 },
            { id: 2, name: "–í–∑—Ä–æ—Å–ª—ã–π –º–æ–ø—Å", emoji: "üêï", rarity: "common", price: 50, mining: 0.1 },
            { id: 3, name: "–ú–æ–ø—Å –≤ –æ—á–∫–∞—Ö", emoji: "ü§ìüêï", rarity: "rare", price: 200, mining: 0.5 },
            { id: 4, name: "–ó–æ–ª–æ—Ç–æ–π –º–æ–ø—Å", emoji: "‚≠êüêï", rarity: "epic", price: 1500, mining: 5 },
            { id: 5, name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –º–æ–ø—Å", emoji: "üí´üêï", rarity: "legendary", price: 10000, mining: 50 }
        ];

        const DONATE_SHOP = [
            {
                id: "boost_1h",
                name: "‚ö° –ë—É—Å—Ç –Ω–∞ 1 —á–∞—Å",
                description: "–£–¥–≤–∞–∏–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ –æ—Ç —Ç–∞–ø–æ–≤",
                price_premium: 10,
                price_tokens: 1,
                effect: "tap_multiplier",
                value: 2,
                duration: 3600
            },
            {
                id: "mining_boost", 
                name: "üè≠ –ë—É—Å—Ç –º–∞–π–Ω–∏–Ω–≥–∞",
                description: "+50% –∫ –º–∞–π–Ω–∏–Ω–≥—É –Ω–∞ 2 —á–∞—Å–∞",
                price_premium: 15,
                price_tokens: 1.5,
                effect: "mining_multiplier", 
                value: 1.5,
                duration: 7200
            },
            {
                id: "skin_gold",
                name: "üé® –ó–æ–ª–æ—Ç–æ–π –º–æ–ø—Å",
                description: "–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π —Å–∫–∏–Ω",
                price_premium: 50,
                price_tokens: 5,
                effect: "skin",
                value: "golden"
            }
        ];

        // –ü–∞–∫–µ—Ç—ã –∑–≤–µ–∑–¥ –¥–ª—è Telegram Stars
        const STARS_PACKAGES = [
            {
                id: "stars_small",
                name: "‚≠ê –ú–∞–ª—ã–π –ø–∞–∫–µ—Ç",
                stars_amount: 100,
                premium_coins: 100,
                bonus: 10,
                description: "–ü–æ–ø—Ä–æ–±—É–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–µ–º–∏—É–º–∞!"
            },
            {
                id: "stars_medium",
                name: "‚≠ê‚≠ê –°—Ä–µ–¥–Ω–∏–π –ø–∞–∫–µ—Ç", 
                stars_amount: 500,
                premium_coins: 500,
                bonus: 50,
                description: "–î–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤"
            },
            {
                id: "stars_large",
                name: "‚≠ê‚≠ê‚≠ê –ë–æ–ª—å—à–æ–π –ø–∞–∫–µ—Ç",
                stars_amount: 1000,
                premium_coins: 1000,
                bonus: 100,
                description: "–ú–∞–∫—Å–∏–º—É–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π!"
            },
            {
                id: "stars_mega",
                name: "‚≠ê‚≠ê‚≠ê‚≠ê –ú–µ–≥–∞ –ø–∞–∫–µ—Ç",
                stars_amount: 5000,
                premium_coins: 5000,
                bonus: 500,
                description: "–î–ª—è –Ω–∞—Å—Ç–æ—è—â–∏—Ö –∫–∏—Ç–æ–≤!"
            }
        ];

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            userId: tg.initDataUnsafe?.user?.id || Math.floor(Math.random() * 1000000),
            mopsCoins: 100,
            premiumCoins: 0,
            gameTokens: 0,
            totalTaps: 0,
            miningRate: 0,
            ownedCards: [],
            activeBoosts: [],
            inventory: [],
            exchangeRate: 0.1
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            loadGameState();
            renderShop();
            renderStarsPackages();
            renderDonateShop();
            renderInventory();
            startMining();
            setupTelegramStars();
            updateUI();
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Stars
        function setupTelegramStars() {
            // Telegram Stars –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂–∏
            // –î–µ–Ω—å–≥–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
            console.log("Telegram Stars –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã");
        }

        // –ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏ –∑–≤–µ–∑–¥
        function initiateStarsPurchase(packageId) {
            const package = STARS_PACKAGES.find(p => p.id === packageId);
            if (!package) {
                showNotification('‚ùå –ü–∞–∫–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }

            // –°–æ–∑–¥–∞–µ–º –∏–Ω–≤–æ–π—Å –¥–ª—è Telegram Stars
            const invoice = {
                title: package.name,
                description: package.description,
                payload: `${gameState.userId}_${packageId}_${Date.now()}`,
                currency: 'XTR', // Telegram Stars
                prices: [
                    {
                        label: `${package.premium_coins + package.bonus} –ø—Ä–µ–º–∏—É–º –º–æ–Ω–µ—Ç`,
                        amount: package.stars_amount * 100 // –í —Ü–µ–Ω—Ç–∞—Ö (1 –∑–≤–µ–∑–¥–∞ = 100 —Ü–µ–Ω—Ç–æ–≤)
                    }
                ],
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è Stars
                need_name: false,
                need_phone_number: false,
                need_email: false,
                need_shipping_address: false,
                is_flexible: false,
                send_phone_number_to_provider: false,
                send_email_to_provider: false
            };

            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã
            tg.openInvoice(invoice, (status) => {
                if (status === 'paid') {
                    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂
                    processStarsPayment(packageId);
                } else if (status === 'failed') {
                    showNotification('‚ùå –ü–ª–∞—Ç–µ–∂ –Ω–µ –ø—Ä–æ—à–µ–ª');
                } else if (status === 'cancelled') {
                    showNotification('‚ö†Ô∏è –ü–ª–∞—Ç–µ–∂ –æ—Ç–º–µ–Ω–µ–Ω');
                } else if (status === 'pending') {
                    showNotification('‚è≥ –ü–ª–∞—Ç–µ–∂ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è...');
                }
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ –≤ –∑–≤–µ–∑–¥–∞—Ö
        function processStarsPayment(packageId) {
            const package = STARS_PACKAGES.find(p => p.id === packageId);
            if (package) {
                const totalCoins = package.premium_coins + package.bonus;
                gameState.premiumCoins += totalCoins;
                gameState.gameTokens += totalCoins * gameState.exchangeRate;
                
                updateUI();
                saveGameState();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                showNotification(
                    `‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É! –ü–æ–ª—É—á–µ–Ω–æ: ${totalCoins}üíé + ${(totalCoins * gameState.exchangeRate).toFixed(1)}ü™ô\n` +
                    `‚≠ê ${package.stars_amount} –∑–≤–µ–∑–¥ –∑–∞—á–∏—Å–ª–µ–Ω—ã –Ω–∞ –º–æ–π –∞–∫–∫–∞—É–Ω—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞!`
                );
                
                // –ó–¥–µ—Å—å –∑–≤–µ–∑–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
                // Telegram –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–æ –Ω–∞ —Å–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω–µ
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        function loadGameState() {
            const saved = localStorage.getItem(`mops_game_${gameState.userId}`);
            if (saved) {
                const parsed = JSON.parse(saved);
                Object.assign(gameState, parsed);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        function saveGameState() {
            localStorage.setItem(`mops_game_${gameState.userId}`, JSON.stringify(gameState));
        }

        // –¢–∞–ø –ø–æ –º–æ–ø—Å—É
        function tapMops() {
            let earned = 1;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –±—É—Å—Ç—ã
            gameState.activeBoosts.forEach(boost => {
                if (boost.effect === 'tap_multiplier' && Date.now() < boost.expiresAt) {
                    earned *= boost.value;
                }
            });
            
            gameState.mopsCoins += earned;
            gameState.totalTaps += 1;
            
            updateUI();
            saveGameState();
            showNotification(`+${earned} üêï`);
            
            return earned;
        }

        // –ü–æ–∫—É–ø–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
        function buyCard(cardId) {
            const card = CARD_TYPES.find(c => c.id === cardId);
            if (!card) return false;
            
            if (gameState.mopsCoins >= card.price) {
                gameState.mopsCoins -= card.price;
                gameState.ownedCards.push(card);
                gameState.miningRate = calculateMiningRate();
                
                updateUI();
                saveGameState();
                renderShop();
                renderInventory();
                showNotification(`‚úÖ –ö—É–ø–ª–µ–Ω: ${card.name}`);
                return true;
            } else {
                showNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç');
                return false;
            }
        }

        // –ü–æ–∫—É–ø–∫–∞ –¥–æ–Ω–∞—Ç –ø—Ä–µ–¥–º–µ—Ç–∞
        function buyDonateItem(itemId, currencyType = 'premium') {
            const item = DONATE_SHOP.find(i => i.id === itemId);
            if (!item) return false;
            
            const price = currencyType === 'premium' ? item.price_premium : item.price_tokens;
            const balance = currencyType === 'premium' ? gameState.premiumCoins : gameState.gameTokens;
            
            if (balance >= price) {
                // –°–ø–∏—Å—ã–≤–∞–µ–º –≤–∞–ª—é—Ç—É
                if (currencyType === 'premium') {
                    gameState.premiumCoins -= price;
                } else {
                    gameState.gameTokens -= price;
                }
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç
                if (item.effect === 'tap_multiplier' || item.effect === 'mining_multiplier') {
                    gameState.activeBoosts.push({
                        id: item.id,
                        name: item.name,
                        effect: item.effect,
                        value: item.value,
                        expiresAt: Date.now() + (item.duration * 1000)
                    });
                }
                
                gameState.inventory.push({
                    id: item.id,
                    name: item.name,
                    type: 'boost'
                });
                
                updateUI();
                saveGameState();
                renderDonateShop();
                showNotification(`‚úÖ –ö—É–ø–ª–µ–Ω: ${item.name}`);
                return true;
            } else {
                showNotification(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${currencyType === 'premium' ? '–ø—Ä–µ–º–∏—É–º –º–æ–Ω–µ—Ç' : '—Ç–æ–∫–µ–Ω–æ–≤'}`);
                return false;
            }
        }

        // –û–±–º–µ–Ω –≤–∞–ª—é—Ç—ã
        function exchangeCurrency(fromCurrency) {
            const amount = parseInt(document.getElementById('exchangeAmount').value) || 0;
            
            if (amount <= 0) {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É');
                return;
            }
            
            if (fromCurrency === 'premium') {
                if (gameState.premiumCoins >= amount) {
                    const tokens = amount * gameState.exchangeRate;
                    gameState.premiumCoins -= amount;
                    gameState.gameTokens += tokens;
                    showNotification(`‚úÖ –û–±–º–µ–Ω: ${amount}üíé ‚Üí ${tokens.toFixed(1)}ü™ô`);
                } else {
                    showNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–µ–º–∏—É–º –º–æ–Ω–µ—Ç');
                    return;
                }
            } else {
                if (gameState.gameTokens >= amount) {
                    const premium = amount / gameState.exchangeRate;
                    gameState.premiumCoins += premium;
                    gameState.gameTokens -= amount;
                    showNotification(`‚úÖ –û–±–º–µ–Ω: ${amount}ü™ô ‚Üí ${premium.toFixed(1)}üíé`);
                } else {
                    showNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤');
                    return;
                }
            }
            
            updateUI();
            saveGameState();
        }

        // –†–∞—Å—á–µ—Ç –º–∞–π–Ω–∏–Ω–≥–∞
        function calculateMiningRate() {
            let rate = gameState.ownedCards.reduce((sum, card) => sum + card.mining, 0);
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –±—É—Å—Ç—ã –º–∞–π–Ω–∏–Ω–≥–∞
            gameState.activeBoosts.forEach(boost => {
                if (boost.effect === 'mining_multiplier' && Date.now() < boost.expiresAt) {
                    rate *= boost.value;
                }
            });
            
            return rate;
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–∞–π–Ω–∏–Ω–≥
        function startMining() {
            setInterval(() => {
                const mined = gameState.miningRate;
                if (mined > 0) {
                    gameState.mopsCoins += mined;
                    updateUI();
                    saveGameState();
                }
            }, 1000); // –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            document.getElementById('coins').textContent = Math.floor(gameState.mopsCoins);
            document.getElementById('taps').textContent = gameState.totalTaps;
            document.getElementById('premium').textContent = gameState.premiumCoins;
            document.getElementById('tokens').textContent = gameState.gameTokens.toFixed(1);
            document.getElementById('miningRate').textContent = gameState.miningRate.toFixed(2);
        }

        // –†–µ–Ω–¥–µ—Ä –º–∞–≥–∞–∑–∏–Ω–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
        function renderShop() {
            const container = document.getElementById('shopItems');
            container.innerHTML = '';
            
            CARD_TYPES.forEach(card => {
                const owned = gameState.ownedCards.some(c => c.id === card.id);
                const canAfford = gameState.mopsCoins >= card.price;
                
                const item = document.createElement('div');
                item.className = 'shop-item';
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${card.emoji} ${card.name} <span style="color: #666; font-size: 12px;">${card.rarity}</span></div>
                        <div class="item-price">üí∞ ${card.price} üêï | ‚õèÔ∏è +${card.mining}/—Å–µ–∫</div>
                    </div>
                    <button class="buy-btn" ${owned || !canAfford ? 'disabled' : ''} 
                            onclick="buyCard(${card.id})">
                        ${owned ? '‚úÖ' : canAfford ? '–ö—É–ø–∏—Ç—å' : '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ'}
                    </button>
                `;
                container.appendChild(item);
            });
        }

        // –†–µ–Ω–¥–µ—Ä –ø–∞–∫–µ—Ç–æ–≤ –∑–≤–µ–∑–¥
        function renderStarsPackages() {
            const container = document.getElementById('starsPackages');
            container.innerHTML = '';
            
            STARS_PACKAGES.forEach(pkg => {
                const packageElement = document.createElement('div');
                packageElement.className = 'stars-package';
                packageElement.innerHTML = `
                    <div class="package-name">${pkg.name}</div>
                    <div class="package-stars">${'‚≠ê'.repeat(pkg.stars_amount / 100)} ${pkg.stars_amount} –∑–≤–µ–∑–¥</div>
                    <div class="package-price">${pkg.premium_coins + pkg.bonus} üíé –ø—Ä–µ–º–∏—É–º –º–æ–Ω–µ—Ç</div>
                    <div class="package-price">${pkg.description}</div>
                    <button class="buy-stars-btn" onclick="initiateStarsPurchase('${pkg.id}')">
                        –ö—É–ø–∏—Ç—å –∑–∞ ${pkg.stars_amount} ‚≠ê
                    </button>
                `;
                container.appendChild(packageElement);
            });
        }

        // –†–µ–Ω–¥–µ—Ä –¥–æ–Ω–∞—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        function renderDonateShop() {
            const container = document.getElementById('donateItems');
            container.innerHTML = '';
            
            DONATE_SHOP.forEach(item => {
                const canAffordPremium = gameState.premiumCoins >= item.price_premium;
                const canAffordTokens = gameState.gameTokens >= item.price_tokens;
                
                const donateItem = document.createElement('div');
                donateItem.className = 'donate-item';
                donateItem.innerHTML = `
                    <div style="margin-bottom: 10px;">
                        <strong>${item.name}</strong>
                        <div style="font-size: 14px; opacity: 0.9;">${item.description}</div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button style="flex: 1; padding: 8px; background: ${canAffordPremium ? '#28a745' : '#6c757d'}; color: white; border: none; border-radius: 8px;" 
                                onclick="buyDonateItem('${item.id}', 'premium')" ${!canAffordPremium ? 'disabled' : ''}>
                            üíé ${item.price_premium}
                        </button>
                        <button style="flex: 1; padding: 8px; background: ${canAffordTokens ? '#ffc107' : '#6c757d'}; color: #333; border: none; border-radius: 8px;" 
                                onclick="buyDonateItem('${item.id}', 'tokens')" ${!canAffordTokens ? 'disabled' : ''}>
                            ü™ô ${item.price_tokens}
                        </button>
                    </div>
                `;
                container.appendChild(donateItem);
            });
        }

        // –†–µ–Ω–¥–µ—Ä –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function renderInventory() {
            const container = document.getElementById('inventoryItems');
            container.innerHTML = '';
            
            if (gameState.ownedCards.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –º–æ–ø—Å–æ–≤ üò¢</p>';
                return;
            }
            
            gameState.ownedCards.forEach(card => {
                const item = document.createElement('div');
                item.className = 'inventory-item';
                item.innerHTML = `
                    <div class="inventory-emoji">${card.emoji}</div>
                    <div>
                        <strong>${card.name}</strong>
                        <div style="font-size: 12px; color: #666;">‚õèÔ∏è +${card.mining}/—Å–µ–∫ | ${card.rarity}</div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–∫–ª–∞–¥–æ–∫
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–Ω—Ç—ã
                document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                tab.classList.add('active');
                const tabName = tab.getAttribute('data-tab');
                document.getElementById(`${tabName}Content`).style.display = 'block';
            });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–∞–ø–∞
        document.getElementById('tapArea').addEventListener('click', tapMops);

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π)
        function testAddPremiumCoins(amount) {
            gameState.premiumCoins += amount;
            gameState.gameTokens += amount * gameState.exchangeRate;
            updateUI();
            saveGameState();
            showNotification(`‚úÖ –¢–µ—Å—Ç: –ø–æ–ª—É—á–µ–Ω–æ ${amount}üíé + ${(amount * gameState.exchangeRate).toFixed(1)}ü™ô`);
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initGame);

        // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - –¥–æ–±–∞–≤–∏–º –∫–Ω–æ–ø–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
        setTimeout(() => {
            const starsTab = document.querySelector('[data-tab="stars"]');
            const testDiv = document.createElement('div');
            testDiv.style.marginTop = '15px';
            testDiv.style.padding = '10px';
            testDiv.style.background = '#f8f9fa';
            testDiv.style.borderRadius = '10px';
            testDiv.style.textAlign = 'center';
            testDiv.innerHTML = `
                <div style="margin-bottom: 10px; font-size: 12px; color: #666;">–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏):</div>
                <div style="display: flex; gap: 5px; justify-content: center;">
                    <button onclick="testAddPremiumCoins(100)" style="padding: 5px 10px; background: #28a745; color: white; border: none; border-radius: 5px; font-size: 12px;">+100üíé</button>
                    <button onclick="testAddPremiumCoins(500)" style="padding: 5px 10px; background: #17a2b8; color: white; border: none; border-radius: 5px; font-size: 12px;">+500üíé</button>
                    <button onclick="testAddPremiumCoins(1000)" style="padding: 5px 10px; background: #dc3545; color: white; border: none; border-radius: 5px; font-size: 12px;">+1000üíé</button>
                </div>
            `;
            document.getElementById('starsContent').appendChild(testDiv);
        }, 1000);
    </script>
</body>
</html>
